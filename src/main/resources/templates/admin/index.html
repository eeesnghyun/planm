<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorate="~{index}">
<head>
    <meta charset="UTF-8">
    	 
	<link rel="stylesheet" href="/plugins/grid/tabulator/tabulator_semanticui.min.css" type="text/css"/>
</head>  
<th:block layout:fragment="content-area">
	<div class="container-fluid">
		<div class="row">
			<div class="col-12 border-bottom">
				<div class="float-left">
					<h4><strong>회사정보</strong></h4>
				</div>
			</div>
		</div>
		
		<div class="row mt-2">
			<div class="col-3 text-center">
				<p>
					<img class="img-thumbnail" src="/images/logo.png" id="userImg" style="width: 100px; height: 100px;">
					<input type="hidden" id="imgSource" value="">
				</p>
				
				<div class="ipt-file">
			    	<input type="text" readonly="readonly" id="fileName">
			        <label>
			            업로드
			            <input type="file" onchange="readUserImg(this)">
			        </label>
			    </div>
			</div>
			
			<div class="col-9">
				<div class="form-group row">								
					<label class="col-sm-1 col-form-label">회사이름</label>
				    <div class="col-sm-3">				    	
					    <input type="text" class="form-control" id="" th:value="${data.cmpName}">					    					    	
				    </div>
				    
				    <label class="col-sm-1 col-form-label">대표자명</label>
				    <div class="col-sm-3">
				    	<input type="text" class="form-control" id="" th:value="${data.cmpOwner}">
				    </div>				    
				</div>
				
				<div class="form-group row">								
					<label class="col-sm-1 col-form-label">주소</label>
				    <div class="col-sm-2">
				    	<input type="text" class="form-control mr-1" id="" th:value="${data.zipcode}" disabled="disabled">
				    </div>
				    <div class="col-sm-9">					    	
						<input type="text" class="form-control" id="" th:value="${data.address}">					    
				    </div>				    		   
				</div>
				
				<div class="form-group row">
					<label class="col-sm-1 col-form-label">대표번호</label>
				    <div class="col-sm-3">
				    	<input type="text" class="form-control" id="" th:value="${data.primenum}">
				    </div>	
				    								
					<label class="col-sm-1 col-form-label">대표메일</label>
				    <div class="col-sm-7">
				    	<div class="form-row align-items-center">
						    <div class="col">									    	
						      	<input type="text" class="form-control" id="email">
						    </div>
						    <div class="col">									    	
						      	<div class="input-group">
						        	<div class="input-group-prepend">
						          		<div class="input-group-text">@</div>
						        	</div>
						        	<input type="text" class="form-control" id="emailServer">
						      	</div>
						    </div>									    
						 </div>
				    </div>				    				    			  
				</div>
			</div>						
		</div>
		
		<div class="row">
			<div class="col-12 border-bottom pb-3 mb-3">
				<div class="float-right">
					<button type="button" class="btn btn-outline-secondary" onclick="save()">저장</button>					
				</div>
			</div>			
		</div>	<!-- End row -->
		
		<div class="row">
			<div class="col-12">
				<ul class="nav nav-tabs" id="myTab" role="tablist">
					<li class="nav-item">
				    	<a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">부서/파트관리</a>
				  	</li>
				  	<li class="nav-item">
				    	<a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">직급관리</a>
				  	</li>							  
				</ul>
							
				<div class="tab-content" id="myTabContent">
					<div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
				  		<div class="container-fluid">
							<div class="row">	
								<div class="col-6">
									<div class="row border-right">
										<div class="col-12 border-bottom">
											<div class="float-left">
												<h5><strong>부서</strong></h5>
											</div>
										</div>
										
										<div class="col-12">
											<div id="gridDept"></div>
										</div>
										
										<div class="col-12">
											<table class="table table-borderless">
												<colgroup>
													<col width="100">
													<col width="">													
												</colgroup>
												<tr>
													<th>부서코드</th>
													<td><input type="text" class="form-control w100" id="deptCode" disabled="disabled" maxlength="4"></td>
												</tr>
												<tr>
													<th>부서명</th>
													<td><input type="text" class="form-control" id="deptName"></td>
												</tr>
												<tr>
													<th>부서장(사번)</th>
													<td>
														<div class="form-inline">
															<input type="text" class="form-control mr-2" id="deptManager" disabled="disabled">
															<input type="text" class="form-control mr-2" id="deptManagerCode" disabled="disabled">
															<button type="button" class="btn-img" style="height: 27px;"><img src="/images/search.png" class="w18-h18"></button>
														</div>
													</td>													
												</tr>
											</table>										
										</div>
										
										<div class="col-12 mb-2">
											<div class="float-right">
												<button type="button" class="btn btn-outline-secondary" id="newBtnDept" onclick="newDept()">신규</button>
												<button type="button" class="btn btn-outline-secondary" id="saveBtnDept" onclick="saveDept()">저장</button>
												<button type="button" class="btn btn-outline-secondary" id="updateBtnDept" onclick="updateDept()" style="display: none;">수정</button>
											</div>
										</div>
									</div>										
								</div>
								
								<div class="col-6">
									<div class="row">
										<div class="col-12 border-bottom">
											<div class="float-left">
												<h5><strong>파트</strong></h5>
											</div>
										</div>
										
										<div class="col-12">
											<div id="gridPart"></div>
										</div>
										
										<div class="col-12">
											<table class="table table-borderless">
												<colgroup>
													<col width="100">
													<col width="">													
												</colgroup>
												<tr>
													<th>파트코드</th>
													<td><input type="text" class="form-control w100" id="partCode" disabled="disabled" maxlength="4"></td>
												</tr>
												<tr>
													<th>파트명</th>
													<td><input type="text" class="form-control" id="partName"></td>
												</tr>
												<tr>
													<th>파트장(사번)</th>
													<td>
														<div class="form-inline">
															<input type="text" class="form-control mr-2" id="partManager" disabled="disabled">
															<input type="text" class="form-control mr-2" id="partManagerCode" disabled="disabled">
															<button type="button" class="btn-img" style="height: 27px;"><img src="/images/search.png" class="w18-h18"></button>
														</div>
													</td>													
												</tr>
											</table>										
										</div>
										
										<div class="col-12 mb-2">
											<div class="float-right">
												<button type="button" class="btn btn-outline-secondary" id="newBtn">신규</button>
												<button type="button" class="btn btn-outline-secondary" id="saveBtn" onclick="save()">저장</button>
												<button type="button" class="btn btn-outline-secondary" id="updateBtn" onclick="update()" style="display: none;">수정</button>
											</div>
										</div>
									</div>											
								</div>
							</div>	<!-- End row -->
						</div>		<!-- End container -->							  		
				  	</div>
				  	
				  	<div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
				  		<div class="container-fluid">
							<div class="row">	
								<div class="col-12 border-bottom">												
									<div class="float-left">
										<h5><strong>직급</strong></h5>
									</div>
								</div>
											
								<div class="col-12">
									<div id="gridPos" style="width: 350px;"></div>
								</div>
								
								<div class="col-12 pb-2">
									<div class="input-group" style="width: 350px;">
										<div class="input-group-prepend">
									    	<span class="input-group-text">직급유형</span>
									  	</div>
									  	<select class="form-control" id="posCategory"></select>
									  	<div class="input-group-append">
									  		<button type="button" class="btn btn-outline-secondary" onclick="">변경</button>
									  	</div>									  	
									</div>								
								</div>										
							</div>
						</div>																			
				  	</div>
				</div>							
			</div>
		</div>	<!-- End row -->										
	</div>		<!-- End container -->			
	
	<script src="/plugins/grid/tabulator/tabulator.min.js"></script>
	<script>
		var gridDept = null;
		var gridPart = null;
		var gridPos  = null;
		
		//부서 그리드 생성
		const initGridDept = function() {
			const data = commonCallAjax("/admin/getDeptList", "");
			
			if (data.code == "ok") {
				const result = data.resultList;

				if (result.length > 0) {
		        	//Grid draw
					gridDept = new Tabulator("#gridDept", {
						layout: "fitDataTable",
						height: "250px",	    
					    columns: [
					    	{title: "부서코드" , field: "deptCode"    , width: 100},
					    	{title: "부서명"   , field: "deptName"    , width: 100},
					    	{title: "부서장"   , field: "deptManager" , width: 100},
						    {title: "생성일"   , field: "createDate"  , width: 120, hozAlign: "center"}						    						   
					    ]			  
					});		        	

					//Data set
					gridDept.on("tableBuilt", function(){				
						gridDept.setData(result);
						gridDept.on("rowClick", function(e, row) {		
							gridDept.deselectRow();
							row.toggleSelect();
					    	//e - click object
					        //row - row component
					        const rowData = row._row.data;
					    	
					        $("#deptCode").prop("disabled", true);
					        $("#deptCode").val(rowData.deptCode);
							$("#deptName").val(rowData.deptName);
							$("#deptManager").val(rowData.deptManager);
							
					    	initGridPart(rowData.deptCode);
						});
					});					
		        }	
			}					    	        
		};
		
		//파트 그리드 생성
		const initGridPart = function(deptCode) {
			const data = commonCallAjax("/admin/getPartList", {"deptCode" : deptCode});
			
			if (data.code == "ok") {
				const result = data.resultList;
				
				let nullMsg = "";				
				if (commonIsNull(deptCode)) {
					nullMsg = "부서를 선택해주세요.";
				} else {
					nullMsg = "데이터가 존재하지 않습니다.";
				}
				
	        	//Grid draw
				gridPart = new Tabulator("#gridPart", {
					layout: "fitDataTable",
					placeholder: nullMsg,
					height: "250px",	    
				    columns: [
				    	{title: "파트코드" , field: "partCode"    , width: 100},
				    	{title: "파트명"   , field: "partName"    , width: 100},
				    	{title: "파트장"   , field: "partManager" , width: 100},
					    {title: "생성일"   , field: "createDate"  , width: 120, hozAlign: "center"}						    						   
				    ]			  
				});		        	

				//Data set
				gridPart.on("tableBuilt", function(){				
					gridPart.setData(result);
					gridPart.on("rowClick", function(e, row) {		
						gridPart.deselectRow();
						row.toggleSelect();
				    	//e - click object
				        //row - row component
				        const rowData = row._row.data;
				    	
				        $("#partCode").val(rowData.partCode);
						$("#partName").val(rowData.partName);
						$("#partManager").val(rowData.partManager);				    	
					});
				});				
			}	
		};
		
		//직급 그리드 생성
		const initGridPos = function() {
			const params = {
				"parentCode" : "POS001",
				"show" : "all" 
			};
			const data = commonCallAjax("/cmn/getCodeList", params);
			
			if (data.code == "ok") {
				const result = data.resultList;
				
				if (result.length > 0) {
		        	//Grid draw
					gridPos = new Tabulator("#gridPos", {
						layout: "fitDataTable",
						height: "250px",	    
					    columns: [
					    	{title: "직급코드" , field: "code"  , width: 100},
					    	{title: "직급명"   , field: "name"  , width: 120},					    						    						    						  
					    	{title: "보이기"   , field: "useYn" , width: 100, hozAlign: "center"}
					    ]			  
					});		        	

					//Data set
					gridPos.on("tableBuilt", function(){				
						gridPos.setData(result);						
					});					
		        }	
			}					    	        
		};
		
		const newDept = function() {
			$("#deptCode").prop("disabled", false);
		};
		
		const saveDept = function() {
			
		};
		
		const updateDept = function() {
			
		};
		
		$(function() {

			initGridDept();
			initGridPart();
			initGridPos();
			
			const comboObj = {"objId" : "posCategory", "params" : {"parentCode" : "POS003"}, "defaultSelected" : "blank"};
			commonInitObj(comboObj);
		});		
	</script>
</th:block>
</html>